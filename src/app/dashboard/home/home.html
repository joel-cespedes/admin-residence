<div class="dashboard">
  <mat-card class="navbar__container dashboard__section">
    <div class="navbar__left">
      <button type="button" mat-icon-button class="navbar__menu-toggle" (click)="toggleSidebar()">
        <span class="mat-icon">menu</span>
      </button>
    </div>

    <div class="navbar__right">
      <button type="button" mat-icon-button class="navbar__btn" (click)="toggleTheme()">
        <span class="mat-icon">{{ isDarkTheme() ? 'light_mode' : 'dark_mode' }}</span>
      </button>

      <button type="button" mat-icon-button class="navbar__btn" [matBadge]="3" matBadgeColor="warn" matBadgeSize="small">
        <span class="mat-icon">notifications</span>
      </button>
      <button
        type="button"
        mat-icon-button
        class="navbar__btn"
        [matBadge]="3"
        matBadgeColor="warn"
        matBadgeSize="small"
        (click)="logout()">
        <span class="mat-icon">logout</span>
      </button>
    </div>
  </mat-card>
  <div class="welcome-card dashboard__section">
    <div class="welcome-card__content">
      <div class="welcome-card__text">
        <h2 class="welcome-card__title">Â¡Hola {{ userName() }}! Bienvenido de nuevo ðŸŽ‰</h2>
        <p class="welcome-card__subtitle">
          Esperamos que tengas un excelente dÃ­a.
          <br />
          Revisa las Ãºltimas estadÃ­sticas y actividades.
        </p>
        <button type="button" size="small" color="primary" class="welcome-card__btn" (click)="goToResidences()">
          Ver Residencias
        </button>
      </div>
      <div class="welcome-card__illustration">
        <img src="worker.png" alt="Congratulations" class="welcome-card__img" />
      </div>
    </div>
  </div>

  @for (metric of metrics(); track metric.title; let i = $index) {
    <mat-card class="metric-card dashboard__section metric-card--{{ metric.color }}">
      <mat-card-content class="metric-card__content">
        <div class="content_header_between">
          <div class="metric-card__icon-container btn_color" [class]="metric.colorIcon">
            <div class="mat-icon">{{ metric.icon }}</div>
          </div>

          <button class="btn_menu" mat-icon-button [matMenuTriggerFor]="menu" aria-label="Acciones">
            <mat-icon>more_vert</mat-icon>
          </button>

          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="setMetricFilter(metric.title, 'year')">Todo</button>
            <button mat-menu-item (click)="setMetricFilter(metric.title, 'week')">Ultima semana</button>
            <button mat-menu-item (click)="setMetricFilter(metric.title, 'month')">Ultimo mes</button>
          </mat-menu>
        </div>

        <div class="metric-card__label">{{ metric.title }}</div>
        <div class="metric-card__number">{{ metric.value }}</div>
        <div class="metric-card__change metric-card__change--{{ metric.changeType }}">
          {{ metric.change }}
        </div>
      </mat-card-content>
    </mat-card>
  }

  <div class="dashboard__section sub_dashboard">
    <mat-card class="chart-card">
      <mat-card-header>
        <div class="content_header_between">
          <div class="title">Mediciones por Semana</div>
          <button type="button" mat-icon-button [matMenuTriggerFor]="revenueMenuRevenue">
            <span class="mat-icon">more_vert</span>
          </button>
          <mat-menu #revenueMenuRevenue="matMenu">
            <button type="button" mat-menu-item>Ver por semana</button>
            <button type="button" mat-menu-item>Ver por mes</button>
          </mat-menu>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-card__legend">
          <div class="chart-card__legend-item">
            <div class="chart-card__legend-color chart-card__legend-color--primary"></div>
            <span>Semana pasada</span>
          </div>
          <div class="chart-card__legend-item">
            <div class="chart-card__legend-color chart-card__legend-color--info"></div>
            <span>Esta semana</span>
          </div>
        </div>
        <div class="chart-card__chart">
          @if (chartsLoading()) {
            <div class="chart-loading">
              <mat-spinner diameter="40"></mat-spinner>
            </div>
          } @else {
            <apx-chart
              [series]="revenueChartData().series"
              [chart]="revenueChartData().chart"
              [colors]="revenueChartData().colors"
              [plotOptions]="revenueChartData().plotOptions"
              [dataLabels]="revenueChartData().dataLabels"
              [grid]="revenueChartData().grid"
              [xaxis]="revenueChartData().xaxis"
              [yaxis]="revenueChartData().yaxis"></apx-chart>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="growth-card">
      <mat-card-header>
        <mat-select class="growth-card__select" value="2023">
          <mat-option value="2023">2023</mat-option>
          <mat-option value="2024">2024</mat-option>
          <mat-option value="2025">2025</mat-option>
        </mat-select>
      </mat-card-header>
      <mat-card-content class="growth-card__content">
        <div class="chartt">
          @if (chartsLoading()) {
            <div class="chart-loading">
              <mat-spinner diameter="40"></mat-spinner>
            </div>
          } @else {
            <apx-chart
              [series]="chartRadial().series"
              [chart]="chartRadial().chart"
              [plotOptions]="chartRadial().plotOptions"
              [labels]="chartRadial().labels"
              [fill]="chartRadial().fill"
              [stroke]="chartRadial().stroke"></apx-chart>
          }
        </div>
        <div class="subtitle">residencias</div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="profile-card dashboard__section">
    <mat-card-content class="profile-card__content">
      <div class="profile-card_left">
        <div class="title">Nuevos residentes</div>
        <div class="info">Year {{ currentYear() }}</div>
        <div class="stats">{{ growthPercentage() > 0 ? '+' : '' }}{{ growthPercentage().toFixed(1) }}%</div>
        <div class="result">{{ totalResidents() }} residentes</div>
      </div>
      <div class="profile-card_right">
        @if (chartsLoading()) {
          <div class="chart-loading">
            <mat-spinner diameter="40"></mat-spinner>
          </div>
        } @else {
          <apx-chart
            [series]="lineChart().series"
            [stroke]="lineChart().stroke"
            [chart]="lineChart().chart"
            [dataLabels]="lineChart().dataLabels"
            [grid]="lineChart().grid"
            [yaxis]="lineChart().yaxis"
            [xaxis]="lineChart().xaxis"></apx-chart>
        }
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="orders-card dashboard__section">
    <mat-card-header>
      <div class="content_header_between">
        <div>
          <div class="title">Residencias</div>
          <div class="sub-title">{{ totalVisibleResidences() }} residencias</div>
        </div>
      </div>
    </mat-card-header>
    <mat-card-content>
      <div class="orders-card__summary">
        <div class="orders-card__total">
          <div class="orders-card__number">{{ totalResidentsFromResidences() }}</div>
          <div class="orders-card__label">Total residencias.</div>
        </div>
        <div class="orders-card__weekly">
          @if (chartsLoading()) {
            <div class="chart-loading">
              <mat-spinner diameter="40"></mat-spinner>
            </div>
          } @else {
            <apx-chart
              [series]="circleChart().series"
              [chart]="circleChart().chart"
              [labels]="circleChart().labels"
              [plotOptions]="circleChart().plotOptions"></apx-chart>
          }
        </div>
      </div>

      <div class="orders-card__categories list_tasks">
        @for (category of orderCategories(); track category.name) {
          <div class="category">
            <div class="category__info">
              <div class="btn_color btn_gray" [class]="category.color">
                <span class="mat-icon">{{ category.icon }}</span>
              </div>
              <div class="category__details">
                <div class="category__name">{{ category.name }}</div>
                <div class="category__subtitle">{{ category.floorCount }} pisos, {{ category.roomCount }} habitaciones</div>
              </div>
            </div>
            <div class="category__stats">
              <div class="category__percentage">{{ category.residentCount }}</div>
            </div>
          </div>
        }
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="orders-card dashboard__section">
    <mat-card-header>
      <div class="content_header_between">
        <div>
          <div class="title">Medidas tomadas</div>
          <div class="sub-title">
            @if (timeFilter() === 'week') {
              En los Ãºltimos 7 dÃ­as
            } @else if (timeFilter() === 'month') {
              En los Ãºltimos 30 dÃ­as
            } @else {
              En los Ãºltimos 12 meses
            }
          </div>
        </div>
        <button type="button" mat-icon-button [matMenuTriggerFor]="ordersMenu">
          <span class="mat-icon">more_vert</span>
        </button>
        <mat-menu #ordersMenu="matMenu">
          <button type="button" mat-menu-item (click)="setTimeFilter('week')">Ultima semana</button>
          <button type="button" mat-menu-item (click)="setTimeFilter('month')">Ultimo Mes</button>
          <button type="button" mat-menu-item (click)="setTimeFilter('year')">Ultimo AÃ±o</button>
        </mat-menu>
      </div>
    </mat-card-header>
    <mat-card-content>
      <div class="orders-card__profit">
        <div class="orders-card__profit-info">
          <span class="orders-card__profit-label">Promedio de mediciones diarias</span>
          <span class="orders-card__profit-amount">{{ dailyMeasurementsAverage() }}</span>
        </div>
      </div>

      <div class="orders-card__chart">
        @if (chartsLoading()) {
          <div class="chart-loading">
            <mat-spinner diameter="40"></mat-spinner>
          </div>
        } @else {
          <apx-chart
            [series]="profitChartData().series"
            [chart]="profitChartData().chart"
            [colors]="profitChartData().colors"
            [stroke]="profitChartData().stroke"
            [dataLabels]="profitChartData().dataLabels"
            [grid]="profitChartData().grid"
            [xaxis]="profitChartData().xaxis"
            [yaxis]="profitChartData().yaxis"></apx-chart>
        }
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="transactions-card dashboard__section">
    <mat-card-header>
      <div class="content_header_between">
        <div class="title">Tareas</div>
        <div class="filters">
          <button type="button" mat-icon-button [matMenuTriggerFor]="filterMenu">
            <span class="mat-icon">more_vert</span>
          </button>
          <mat-menu #filterMenu="matMenu">
            <button type="button" mat-menu-item (click)="setTaskFilter('all')">Todas las tareas</button>
            <button type="button" mat-menu-item (click)="setTaskFilter('active')">Tareas activas</button>
            <button type="button" mat-menu-item (click)="setTaskFilter('completed')">Tareas completadas</button>
          </mat-menu>
        </div>
      </div>
    </mat-card-header>
    <mat-card-content>
      <div class="list_tasks">
        @for (transaction of categories(); track transaction.id) {
          <div class="transaction">
            <div class="transaction__info">
              <div class="btn_color" [class]="transaction.color">
                <span class="mat-icon">{{ transaction.icon }}</span>
              </div>
              <div class="transaction__details">
                <div class="transaction__type">{{ transaction.type }}</div>
                <div class="transaction__company">{{ transaction.company }}</div>
              </div>
            </div>
            <div class="transaction__amount transaction__amount--{{ transaction.status }}">
              {{ transaction.amount }}
            </div>
          </div>
        }
      </div>
    </mat-card-content>
  </mat-card>
</div>
